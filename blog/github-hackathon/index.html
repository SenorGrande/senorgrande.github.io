<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9f068d288fefd079fab7.css">.header-module--header--3A712{padding:1rem 0 3rem}.header-module--title--33kOg{color:#000;font-size:3rem;text-decoration:none}.header-module--nav-list--87D9u{display:flex;list-style-type:none;margin:0}.header-module--nav-item--1ixk0{color:#999;font-size:.9rem;margin-right:1.3rem;text-decoration:none}.header-module--nav-item--1ixk0:hover{color:#666}.header-module--active-nav-item--26N0B{color:#333}.footer-module--footer--R2bpz{margin-top:3rem}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{color:orange;background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:sans-serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.layout-module--container--2TGku{margin:0 auto;max-width:750px;padding:1rem;display:flex;flex-direction:column;min-height:100vh}.layout-module--content--3nIku{flex-grow:1}.blog-module--posts--a25pe{list-style-type:none;margin:0}.blog-module--post--1jMia{margin:1rem 0}.blog-module--post--1jMia a{background:#f4f4f4;color:#000;display:block;padding:1rem;text-decoration:none}.blog-module--post--1jMia a:hover{background:#e4e4e4}.blog-module--post--1jMia h2{margin-bottom:0}.blog-module--post--1jMia p{color:#777;font-size:.8rem;font-style:italic}</style><meta name="generator" content="Gatsby 2.18.12"/><title data-react-helmet="true">How to create a GitHub Action to run Unit Tests &amp; perform Webhooks | Senor Grande&#x27;s Blog...</title><link as="script" rel="preload" href="/webpack-runtime-93800de5fbb5b85039e8.js"/><link as="script" rel="preload" href="/app-c593fadebb2cdbf03700.js"/><link as="script" rel="preload" href="/styles-7b77c40001eb780bb93d.js"/><link as="script" rel="preload" href="/commons-e2ecdd7eec8533740b60.js"/><link as="script" rel="preload" href="/component---src-templates-blog-js-905806397317b137f1de.js"/><link as="fetch" rel="preload" href="/page-data/blog/github-hackathon/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="layout-module--container--2TGku"><div class="layout-module--content--3nIku"><header class="header-module--header--3A712"><h1><a class="header-module--title--33kOg" href="/">Senor Grande&#x27;s Blog...</a></h1><nav><ul class="header-module--nav-list--87D9u"><li><a class="header-module--nav-item--1ixk0" href="/">Home</a></li><li><a class="header-module--nav-item--1ixk0" href="/blog">Blog</a></li><li><a class="header-module--nav-item--1ixk0" href="/about">About</a></li><li><a class="header-module--nav-item--1ixk0" href="/contact">Contact</a></li></ul></nav></header><h1>How to create a GitHub Action to run Unit Tests &amp; perform Webhooks</h1><p>2020-04-8</p><div><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 33.51063829787234%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABZUlEQVQY02MQZLfERHzMptwMRtyMRjxMJvwsZoIclliVMQCxEIeVAJsFEIG0sZgBkZp8kKlBsq5apLpisIyIG1AEqAaIIHrADAsgySDMZQOkJPgdpQSdRbltVWT8gNJ6GlEJCVPCw7sSEqc4OxQDFYhw2QDFJQWcxXjthTmtxfkcgJYxuDmV+XrXpabNSkufnZWzIMC/KSSkPTysMzwMpDMmZkJyygygrJ1Vrr9fI5CRnjk3Ln5SVvZ8OTFPhur6LZ39B6vrN9c1b++bespIJz4ldWZj267yqvVN7bsTkyYF+De6OZcBFfRNPQnUA1QPtCMstFNXPYpBVTZAXzNaSzlMVS7Q1jLHz6feQCtGUtjJRC8RKKipFKKuEKQk7aupFGqgFevuUgFEWkohGorBQG8y8DKZcDMBQ9UYiDgZDDgY9IAMflZzcFAb87CY8LKa8rGaAdlAEaACTgZ9XmYTXmZTAVZzAFMjYgGRsZuyAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="GitHub Hackathon"
        title="GitHub Hackathon"
        src="/static/766f920a0350c75dd8cdc3c31b061fc1/8c557/github-hackathon.png"
        srcset="/static/766f920a0350c75dd8cdc3c31b061fc1/4dcb9/github-hackathon.png 188w,
/static/766f920a0350c75dd8cdc3c31b061fc1/5ff7e/github-hackathon.png 375w,
/static/766f920a0350c75dd8cdc3c31b061fc1/8c557/github-hackathon.png 700w"
        sizes="(max-width: 700px) 100vw, 700px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p><a href="https://github.com/SenorGrande/Test-Webhook">Test-Webhook - My GitHub Action</a></p>
<p>My GitHub Action
<a href="https://githubhackathon.com/">GitHub ran a Hackathon last month to create and submit a GitHub Action.</a>
I’d never entered a Hackathon before and had been playing around with different Actions ranging from deploying to NPM, running tests, publishing a Gatsby site and deploying to AWS S3. It was time to make my own so I could better understand how they work, this article will share my learnings.</p>
<p>I wanted to create an Action that would run unit tests in a project, and then HTTP POST the result to a URL. In essence, it runs <code>NPM test</code> and then performs a Webhook. The action consists of the following three files:</p>
<h2>action.yml</h2>
<p>This file is used to define the Action. Name, description, and branding are used by the GitHub Marketplace when displaying your Action.
“runs” defines that Docker is used for this action and to use “Dockerfile”, another file in our repo, to build an image from it.</p>
<pre><code>name: 'NPM Test &#x26; Webhook'
description: 'Run npm tests &#x26; post result to http endpoint'
runs:  
  using: 'docker'  
  image: 'Dockerfile'
branding:
  icon: 'box'
  color: 'orange'
</code></pre>
<h3>Dockerfile</h3>
<p>This Dockerfile uses Node as a base image and installs the Curl package so that we can perform an HTTP POST. The “entrypoint” shell script is then copied, and the executable permission is applied to it.</p>
<pre><code>FROM node:12.16.1 # Install curl
RUN apt update &#x26;&#x26; apt install -y curl # Add the entry point
ADD entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh # Load the entry point
ENTRYPOINT ["/entrypoint.sh"]
</code></pre>
<h3>entrypoint.sh</h3>
<p>This script will run inside the Docker container, it installs the node modules, runs the build script, and then runs the test script. The output from the npm test command is then searched for failed tests. A pass or fail is then POSTed to the webhook URL that is set as a GitHub secret.
All echo commands will show up in the GitHub Action logs to make debugging easier.</p>
<pre><code>#!/bin/bashnpm ci
npm run build --if-present
VALID=$(npm test || true)
echo $VALID
PASSING="$(echo $VALID | grep -o '[0-9] failing')" # If all tests pass, $PASSING will be empty
if [ -z "$PASSING" ]
then
  RESULTS="pass"
else
  RESULTS="fail"
fi RES=$(curl --write-out '%{http_code}' --silent --output /dev/null -X POST -H "Content-Type: application/json" --data "{ \"data\": \"$RESULTS\" }"  $WEBHOOK_URL) # If RESULTS is fail or curl returned 404, throw an error
if [ "$RES" != "200" ]
then
  echo "*** Post failed"
  exit 64
elif [ $RESULTS = "fail" ]
then
  echo "*** NPM Test failed"
  exit 64
fi
</code></pre>
<p>How to Use the GitHub Action</p>
<p>With our Action done, here’s an example of how to implement it to run on another GitHub project. Create a new YAML file in <code>.github/workflows</code>. (Create the directory in your repository if it doesn’t already exist. Having an “.” at the beginning makes it a hidden folder, <code>ls -a</code> will show all files and directories).</p>
<p>First, we use actions/checkout, this will check out the code and allow our Action to run the NPM commands successfully. We then provide the webhook URL as an environment variable which has been set as a secret on the repository.</p>
<pre><code>name: NPM Test &#x26; Webhook
on: push

jobs:
  webhook:
    name: NPM Test &#x26; Webhook action
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Run NPM Test &#x26; POST
      uses: SenorGrande/test-webhook@v1
      env:
        WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
</code></pre>
<p><a href="https://github.com/SenorGrande/node-app">Have a look at my simple Node server repo that I used for testing if you’re lost</a></p>
<h2>Using the Action to change the colour of an RGB LED</h2>
<p>I used this Action to POST to an HTTP endpoint on my Node-RED Docker container running on my Raspberry Pi. Node-RED would then change the colour of an RGB LED to green if the tests all passed, otherwise it would change to red.
To read on how I got Node-RED and Johnny-Five working in a Docker container, check out my previous article:</p>
<p><a href="https://medium.com/@hewett.j.connor/using-johnny-five-with-node-red-and-docker-98daa5b31cc">Using Johnny Five with Node-RED and Docker</a></p>
<p>Cheers for reading!</p></div></div><footer class="footer-module--footer--R2bpz"><p>Senor Grande<!-- -->, copyright 2020</p></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/github-hackathon";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-c593fadebb2cdbf03700.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-905806397317b137f1de.js"],"component---src-pages-404-js":["/component---src-pages-404-js-16b9239c1dac9b9df3db.js"],"component---src-pages-about-js":["/component---src-pages-about-js-7eae9e40fb2937d7aeae.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-7dda43ab3832653cb05c.js"],"component---src-pages-contact-js":["/component---src-pages-contact-js-bd3471777a62fa80c4b9.js"],"component---src-pages-index-js":["/component---src-pages-index-js-80ac8071d240525ebf17.js"]};/*]]>*/</script><script src="/component---src-templates-blog-js-905806397317b137f1de.js" async=""></script><script src="/commons-e2ecdd7eec8533740b60.js" async=""></script><script src="/styles-7b77c40001eb780bb93d.js" async=""></script><script src="/app-c593fadebb2cdbf03700.js" async=""></script><script src="/webpack-runtime-93800de5fbb5b85039e8.js" async=""></script></body></html>