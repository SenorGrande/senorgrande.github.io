<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9f068d288fefd079fab7.css">.header-module--header--3A712{padding:1rem 0 3rem}.header-module--title--33kOg{color:#000;font-size:3rem;text-decoration:none}.header-module--nav-list--87D9u{display:flex;list-style-type:none;margin:0}.header-module--nav-item--1ixk0{color:#999;font-size:.9rem;margin-right:1.3rem;text-decoration:none}.header-module--nav-item--1ixk0:hover{color:#666}.header-module--active-nav-item--26N0B{color:#333}.footer-module--footer--R2bpz{margin-top:3rem}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{color:orange;background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:sans-serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.layout-module--container--2TGku{margin:0 auto;max-width:750px;padding:1rem;display:flex;flex-direction:column;min-height:100vh}.layout-module--content--3nIku{flex-grow:1}.blog-module--posts--a25pe{list-style-type:none;margin:0}.blog-module--post--1jMia{margin:1rem 0}.blog-module--post--1jMia a{background:#f4f4f4;color:#000;display:block;padding:1rem;text-decoration:none}.blog-module--post--1jMia a:hover{background:#e4e4e4}.blog-module--post--1jMia h2{margin-bottom:0}.blog-module--post--1jMia p{color:#777;font-size:.8rem;font-style:italic}</style><meta name="generator" content="Gatsby 2.18.12"/><title data-react-helmet="true">Using Johnny Five with Node-RED and Docker | Senor Grande&#x27;s Blog...</title><link as="script" rel="preload" href="/webpack-runtime-93800de5fbb5b85039e8.js"/><link as="script" rel="preload" href="/app-c593fadebb2cdbf03700.js"/><link as="script" rel="preload" href="/styles-7b77c40001eb780bb93d.js"/><link as="script" rel="preload" href="/commons-e2ecdd7eec8533740b60.js"/><link as="script" rel="preload" href="/component---src-templates-blog-js-905806397317b137f1de.js"/><link as="fetch" rel="preload" href="/page-data/blog/johnny-five-docker/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="layout-module--container--2TGku"><div class="layout-module--content--3nIku"><header class="header-module--header--3A712"><h1><a class="header-module--title--33kOg" href="/">Senor Grande&#x27;s Blog...</a></h1><nav><ul class="header-module--nav-list--87D9u"><li><a class="header-module--nav-item--1ixk0" href="/">Home</a></li><li><a class="header-module--nav-item--1ixk0" href="/blog">Blog</a></li><li><a class="header-module--nav-item--1ixk0" href="/about">About</a></li><li><a class="header-module--nav-item--1ixk0" href="/contact">Contact</a></li></ul></nav></header><h1>Using Johnny Five with Node-RED and Docker</h1><p>2019-06-24</p><div><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.23404255319149%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABYklEQVQY0z1QzUsCQRT3T+lUJ6+aJenMzox0rQ4RgUrdOnSILtEf0KFDpyAoOoRESVERFWtmmWluCmauiqsp5K7h+rEXzWNvdy0YHo/35vf1LK0yMx6F15fpQCGDBvtR6KBBtCpVJQLzbpVB0yyRToW1JKJK1PjPLCasXWGwuwy4Avvc8QF3ckiP9jgxzmk1CvP7i3EA9GQP9Al+Qs4bLCYYFp1PpohodWXa6/MtLy36ffMzs3M3p6hXB1IaOrcLYefDlaOQdCf4SU03QsGCoWx4U0vk/RmnH7EQRq+8Kx1B3wXSksAUlVJu/szuXRhJhpzZ2FRXjwMo+g/WI3286OBM1C3GsZIn7TLEY2DqK4fvgraNtdGdLauYcBnKut4ws2k+F8epCMrGUFHARYHLRDHQ1UWi1VjpDe1uWzfXx0yYUYcHY394AuZBTdXt6HQQGHqofdnzdO24Ddp6dU9zeG36C3IZCkO6ILG9AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Johnny Five"
        title="Johnny Five"
        src="/static/9bbafa3b112cc845f1c8f7f5f9b9695f/8c557/johnny-five.png"
        srcset="/static/9bbafa3b112cc845f1c8f7f5f9b9695f/4dcb9/johnny-five.png 188w,
/static/9bbafa3b112cc845f1c8f7f5f9b9695f/5ff7e/johnny-five.png 375w,
/static/9bbafa3b112cc845f1c8f7f5f9b9695f/8c557/johnny-five.png 700w"
        sizes="(max-width: 700px) 100vw, 700px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>This article, I will show you how to create a Node-RED Docker container running on a Raspberry Pi. The Raspberry Pi connects to an Arduino to control and change the colour of an RGB LED, utilising the Johnny-Five framework.</p>
<p>Prerequisites:</p>
<ul>
<li>Raspberry Pi with Docker and Docker Compose installed</li>
<li>Arduino with the "firmata" script installed</li>
<li>An RGB LED with 330 Ohm resistors</li>
</ul>
<p><a href="https://github.com/SenorGrande/hue-app">All the code can be found at my GitHub repo</a><br>
Included is a React App to demonstrate sending POST requests to the Node-RED HTTP endpoint.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.74468085106383%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACvUlEQVQoz2P49u3bhfPnX799++f//3///3/89GnR4sVbt2z5+vffj79AAXyAIW36MglJKbO0Etf+pTqt80Onrjixd9eCNRsa56+6dPMuUMXjx4+BFmDX7Ns1R0BWUcUvUi8qnTGnR6psUtfi1YlTl6S1TT119gJQxcWLF1+/fg1k/MMADFXr95rk1mlVTBAsniBYMlGwuJ+nsE80v9OgqHnTtYdvXj4/dOzQxUsXHj58eO/evfv37z948OA+GAAZDC6TVmb1zoievpIhr1+gbKpYWr1scLJCcbeFu9eiXYdevn25+/T+o+dOHjl85NChQ8eOHTsOBgcOHDh79iyDR8fs+Oa+8L55bBlt/MWTJMsnmTRMVWiaJ51cMX/jjjevnu7cuezQvg0nT54+evToKQg4efLIkSNA7zAk1LYpl/VrRGepeIfxlE0TKZ1k27vEfvIaobjSBVt2v3589/CyqadWz7x45dqFc2cvXrgAQcAIugTUXNA/TbJyqnxEhpp3GG/5dP6iCWGzN0Qv2SUQW7xg664PT5/tOLBl4+nj506ePn7i+BkYALr/0qVLDC2LVum2LlCMyFD1CQdq5ivqd520wn/OZu6Eqjkb9zzfs3f25slz9h45e+LkkaNHTp48CXb1ycOHD58/f54hffICm65FimFpSh4hAhXTeQv61Btm205cI5NR1T2h9tCVbatPnjhx4f7jR/eBof0ADBChHVffod8wPbC8SS8kgb10GkfhRMPWeS5T10lm1NSsWHXj5bf7z7/hSmkM4ZXNkqUT1eMLnBOzDJtmyeS2KtZMFauZLZpQPnnxeqCKv//+/f2HHTAsO3wmZ+Vuh5YZpnVT4tonV0yYWrfpYOvWwwv3n3jxBpSw/uJO4QxA/P3X729//n798/fDj18ffv7+8es3nswAtPDjx4+vXr0CplkAa5BQooeMJbkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Arduino"
        title="Arduino"
        src="/static/9912532b83469bbf43164c02447732b4/8c557/arduino-led.png"
        srcset="/static/9912532b83469bbf43164c02447732b4/4dcb9/arduino-led.png 188w,
/static/9912532b83469bbf43164c02447732b4/5ff7e/arduino-led.png 375w,
/static/9912532b83469bbf43164c02447732b4/8c557/arduino-led.png 700w"
        sizes="(max-width: 700px) 100vw, 700px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<h2>Dockerfile of the Node-RED container</h2>
<ol>
<li>
<p>We start with a base Node-RED image that is built for devices with ARM processors</p>
<pre><code>FROM nodered/node-red-docker:rpi
</code></pre>
</li>
<li>
<p>The Dockerfile copies the flows and settings files into the image</p>
<pre><code>COPY ./flows.json /data/flows.json
COPY ./settings.js /data/settings.js
</code></pre>
</li>
<li>
<p>Switch to root user so we can install NPM packages</p>
<pre><code>USER root
</code></pre>
</li>
<li>
<p>Install johnny-five and other packages so that we can get the Johnny-five nodes in Node-RED</p>
<pre><code>RUN npm install johnny-five --unsafe-perm --force \
&#x26;&#x26; npm install raspi-io --unsafe-perm --force \
&#x26;&#x26; npm install node-red-contrib-gpio --unsafe-perm --force
</code></pre>
</li>
<li>
<p>Add the node-red user to the <code>dialout</code> group so the container can connect to the Arduino</p>
<pre><code>RUN usermod -a -G dialout node-red
</code></pre>
</li>
<li>
<p>Change the user to node-red as it is not good practice for a Docker container to be running as root</p>
<pre><code>USER node-red
</code></pre>
</li>
</ol>
<h3>Putting it all together...</h3>
<pre><code>FROM nodered/node-red-docker:rpi

COPY ./flows.json /data/flows.json
COPY ./settings.js /data/settings.js

USER root

RUN npm install johnny-five --unsafe-perm --force \
&#x26;&#x26; npm install raspi-io --unsafe-perm --force \
&#x26;&#x26; npm install node-red-contrib-gpio --unsafe-perm --force

RUN usermod -a -G dialout node-red

USER node-red
</code></pre>
<h2>Node-RED flow &#x26; settings</h2>
<p>The flow consists of an HTTP endpoint node that will allow Node-RED to accept POST requests. For example, when a JSON payload contains an object such as <code>{colour:"#ff0000"}</code> (Red), the Johnny5 node will change the colour of the RGB LED to the colour specified.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 383px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 38.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABa0lEQVQY03WOy07CQBiFu/IBXLD23XwFg+AGjTHuvYCX6IqFgcSGSCKJJgoEDUIhBhoihVIovUHbaUtrbaZM7UDCwsvJycyXzH/+M8T8b/kIBY5jauM04PdVLjHldlVubybGLPVhjoJwIBwiFtdPI4Qsyx7zLN/ZnNIbvcp6pxzhqhGHWVPYQ+gHCEEcDoKQsFewZFlRgrlfHVIdjtLktiK+T6T2zOxDT0O4GYsAgDfNsWWNTZMPzyVA+KVpOoQQWAowJWDIhiHrQHbdz1UShznunm5fv1aOKCpVe0vWqWSvnx6wLYZhBUHgh3eyeNNsXNL0FT8qqNNOsPwiQjisql1dxwagBwCzAMZ1Z5KEewSpNRKpkdgYCdSAr4mTvm7olm350A9FBP/Itu2w+TR3HLuI7qRi8dR2PBWNnW0dpBPn5Em+nHMch/Dxkt/2w3z4/FgvkKXM7VOGfM6QxSxZyuZfcuVmsct9eJ73DSSJqJLS6RNmAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Node-RED"
        title="Node-RED"
        src="/static/b7a7a147090f77edc0f7c10babff0117/d0c94/node-red.png"
        srcset="/static/b7a7a147090f77edc0f7c10babff0117/4dcb9/node-red.png 188w,
/static/b7a7a147090f77edc0f7c10babff0117/5ff7e/node-red.png 375w,
/static/b7a7a147090f77edc0f7c10babff0117/d0c94/node-red.png 383w"
        sizes="(max-width: 383px) 100vw, 383px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span>
The Johnny5 Node is like a function node in Node-RED. However, it is triggered when the Node-RED flow first runs, and not on input. We can overcome this by including the following in our johnny5 node:</p>
<pre><code>node.on('input', function(msg){});
</code></pre>
<p>This function is triggered when the node receives an input. In this flow, when a POST request is received by the endpoint, the Johnny5 node will set the led colour to the hex value stored in msg.payload.colour.</p>
<h2>Johnny5 Node Code</h2>
<pre><code>// Initialize the RGB LED
var led = new five.LED.RGB({
  pins: {
    red: 9,
    green: 10,
    blue: 11
  }
});

// Turn it on and set the initial color
led.on();
led.color("#ffffff");

node.on('input', function(msg) {
  led.color(msg.payload.colour);
});
</code></pre>
<h2>Settings.js</h2>
<p>In the settings.js file, allow GET requests so we don't get CORS errors when trying to POST a colour from the example React App.</p>
<pre><code>httpNodeCors: {
  origin: "*",
  methods: "GET,PUT,POST,DELETE"
}
</code></pre>
<h2>Docker-Compose</h2>
<p>The Docker Compose script consists of two services, the backend service is the Node-RED container and the frontend service is an Apache container that serves up the build folder of the example React app in the GitHub repo. The backend adds the Arduino Uno as a device to the customer, alter this to the address of the Arduino on the Raspberry Pi.</p>
<pre><code>version: '3'
  services:

    backend:
      build: ./backend
      ports:
        - "1880:1880"
      devices:
        - "/dev/ttyACM0:/dev/ttyACM0"

    frontend:
      build: ./frontend
      ports:
        - "8090:80"
</code></pre>
<p>Run <code>docker-compose up</code> in the same directory as the docker-compose.yml script to build and start both services, or follow the README in the GitHub Repo on how to build and run the containers individually.</p>
<p>Thanks for reading.</p></div></div><footer class="footer-module--footer--R2bpz"><p>Senor Grande<!-- -->, copyright 2020</p></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/johnny-five-docker";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-c593fadebb2cdbf03700.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-905806397317b137f1de.js"],"component---src-pages-404-js":["/component---src-pages-404-js-16b9239c1dac9b9df3db.js"],"component---src-pages-about-js":["/component---src-pages-about-js-7eae9e40fb2937d7aeae.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-7dda43ab3832653cb05c.js"],"component---src-pages-contact-js":["/component---src-pages-contact-js-bd3471777a62fa80c4b9.js"],"component---src-pages-index-js":["/component---src-pages-index-js-80ac8071d240525ebf17.js"]};/*]]>*/</script><script src="/component---src-templates-blog-js-905806397317b137f1de.js" async=""></script><script src="/commons-e2ecdd7eec8533740b60.js" async=""></script><script src="/styles-7b77c40001eb780bb93d.js" async=""></script><script src="/app-c593fadebb2cdbf03700.js" async=""></script><script src="/webpack-runtime-93800de5fbb5b85039e8.js" async=""></script></body></html>